# SparsePrintInspector: Distributed Anomaly Detection for Print Quality Inspection

## Overview  
**SparsePrintInspector** is an industrial anomaly detection framework designed for print quality inspection, combining the efficiency of sparse neural networks with the robustness of PatchCore-inspired feature matching. It leverages distributed parallel processing to enable fast, scalable deployment on CPU-based systems, making it ideal for resource-constrained environments such as manufacturing facilities.  

## Key Features  

### 1. **PatchCore-Inspired Anomaly Detection Backbone**  
- **Memory Bank of Nominal Features**: The framework builds a memory bank of feature embeddings extracted from defect-free (nominal) training images using a sparsified ResNet-50 backbone. This memory bank serves as a reference for identifying anomalies in test images.  
- **Subsampled CoreSet**: To optimize memory usage, the memory bank is subsampled using a random selection strategy, reducing its size by up to 90% while retaining over 95% of the detection accuracy. This makes the system lightweight and suitable for edge deployment.  
- **k-Nearest Neighbor (k-NN) Distance Scoring**: Anomalies are detected by computing the distance between test image features and their nearest neighbors in the memory bank. This unsupervised approach eliminates the need for labeled defect data during training.  
- **Pixel-Level Anomaly Localization**: The framework generates detailed anomaly maps by interpolating feature distances, providing precise localization of defects in high-resolution images. This is particularly useful for root-cause analysis in print quality inspection.  

### 2. **SparseML Integration for Efficient Inference**  
- **Sparsified ResNet-50 Backbone**: The ResNet-50 model is sparsified using SparseML, with 80-90% of its weights pruned to zeros. This significantly reduces computational overhead, enabling **3-5x faster inference on CPUs** compared to dense models.  
- **Structured Pruning**: The pruning process preserves the model’s critical feature extraction capabilities, ensuring high detection accuracy while minimizing resource usage.  
- **CPU-Friendly Operations**: The framework avoids GPU dependency by using lightweight tensor operations and Global Average Pooling (GAP), making it ideal for deployment on low-cost hardware.  

### 3. **Distributed Parallel Processing**  
- **Thread-Safe Memory Bank**: The memory bank is designed to support concurrent access, enabling parallel similarity scoring across multiple distributed nodes. This allows the system to scale horizontally for high-throughput industrial inspections.  
- **Asynchronous Batch Processing**: The framework uses `ThreadPoolExecutor` to process images in parallel, maximizing CPU core utilization and achieving near-linear scalability.  

### 4. **Interpretable Anomaly Detection**  
- **Configurable Thresholding**: Anomaly thresholds are automatically derived from the distribution of scores in the memory bank, ensuring adaptability to diverse print environments.  
- **Visualization Tools**: The framework provides detailed visualizations, including anomaly score histograms, ROC curves, and confusion matrices, to help users fine-tune detection sensitivity and evaluate performance.  
- **Anomaly Maps**: High-resolution anomaly maps are generated by upscaling feature distance scores (from 7x7 to 224x224), providing intuitive visual feedback for defect localization.  

### 5. **Scalability and Deployment**  
- **Lightweight and Portable**: The combination of sparse models and subsampled memory banks makes the framework lightweight and portable, suitable for deployment on edge devices or distributed systems.  
- **Distributed Computing Support**: The framework’s architecture is designed to support distributed computing, enabling seamless integration into large-scale industrial inspection pipelines.  

## Who is it for?  
**SparsePrintInspector** is specifically designed for **print quality inspection** in industrial settings. It addresses the challenges of detecting subtle defects in high-resolution images while maintaining low latency and high throughput. By leveraging sparse neural networks and PatchCore-inspired feature matching, the framework achieves state-of-the-art performance in anomaly detection, making it a powerful tool for quality assurance in manufacturing and printing industries.  